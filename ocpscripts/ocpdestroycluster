#!/usr/bin/env bash

temp_file=$(mktemp)

tmux new-window -n "destroy: $1" "bash -c 'read -p \"Are you sure you want to destroy the cluster \\\"$1\\\"? (y/N): \" confirm; echo \$confirm > $temp_file; bash'"

while [ ! -s "$temp_file" ]; do
  sleep 1
done

confirm=$(cat "$temp_file")
rm -f "$temp_file"

if [[ "$confirm" != "y" && "$confirm" != "Y" ]]; then
  exit 0
fi

tmux send-keys "/usr/local/bin/destroycluster.py -i /vms/clusters/$1/$1.json -n $1" C-m

