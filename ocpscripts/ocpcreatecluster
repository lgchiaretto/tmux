#!/usr/bin/env bash

files=$(find /vms/clusters/variables-files/ -type f -exec basename {} \; | sed 's/^ansible-vars-//' | sed 's/\.json$//')

selected_file=$(echo "$files" | sort | fzf-tmux --header=$'Select a variable file:\n\n' --layout=reverse  -h 40 -p "15%,20%" --exact)

if [ -n "$selected_file" ]; then
    tmux new-window -n vimcluster "vim /vms/clusters/variables-files/ansible-vars-$selected_file.json; tmux wait-for -S vim-done"
    tmux wait-for vim-done
    tmux send-keys "/usr/local/bin/createcluster.py -i /vms/clusters/variables-files/ansible-vars-$selected_file.json" C-m
else
#    tmux display -d 3000 "No file selected"
    exit 0
fi
